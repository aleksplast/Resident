Turbo Assembler	 Version 4.1	    03/05/23 15:48:43	    Page 1
resident.asm



      1				     .286
      2	0000			     .model tiny
      3	0000			     .code
      4
      5				     org 100h
      6				     locals @@
      7
      8
      9	0100  FA		     Start:	     cli
     10
     11	0101  33 C0				     xor ax, ax
     12	0103  33 DB				     xor bx, bx
     13	0105  33 C9				     xor cx, cx
     14	0107  33 D2				     xor dx, dx
     15	0109  33 F6				     xor si, si
     16	010B  33 FF				     xor di, di
     17	010D  8E C3				     mov es, bx
     18	010F  BB 0024				     mov bx, 4 * 9
     19
     20	0112  26: 8B 07				     mov ax, es:[bx]
     21	0115  A3 01C6r				     mov Old09ofs, ax
     22
     23	0118  26: C7 07	0137r			     mov es:[bx], offset New09
     24
     25	011D  26: 8B 47	02			     mov ax, es:[bx + 2]
     26	0121  A3 01C8r				     mov Old09Seg, ax
     27
     28	0124  8C C8				     mov ax, cs
     29	0126  26: 89 47	02			     mov es:[bx	+ 2], ax
     30
     31	012A  FB				     sti
     32
     33	012B  B8 3100				     mov ax, 3100h
     34	012E  BA 0261r				     mov dx, offset EOP
     35	0131  C1 EA 04				     shr dx, 4
     36	0134  42				     inc dx
     37	0135  CD 21				     int 21h
     38
     39
     40	0137			     New09	     proc
     41
     42	0137  50 53 51 52 56 57	06		     push ax bx	cx dx si di es
     43
     44	013E  E4 60				     in	al, 60h
     45	0140  3C 3B				     cmp al, 3bh
     46	0142  75 7A				     jne @@Nothing
     47
     48	0144  52				     push dx
     49	0145  51				     push cx
     50	0146  53				     push bx
     51	0147  50				     push ax
     52
     53	0148  33 C0				     xor ax, ax
     54	014A  33 DB				     xor bx, bx
     55	014C  33 C9				     xor cx, cx
     56	014E  33 D2				     xor dx, dx
     57	0150  33 F6				     xor si, si
Turbo Assembler	 Version 4.1	    03/05/23 15:48:43	    Page 2
resident.asm



     58	0152  33 FF				     xor di, di
     59
     60	0154  BB B800				     mov bx, 0b800h
     61	0157  8E C3				     mov es, bx
     62	0159  B4 4E				     mov ah, 4eh
     63	015B  B0 01				     mov al, 01h
     64	015D  BF 0134				     mov di, 148d + 160d
     65	0160  57				     push di
     66	0161  BA 0006				     mov dx, 6d
     67	0164  B9 0006				     mov cx, 6d
     68	0167  BE 024Ar				     mov si, offset style1
     69	016A  E8 0094				     call DrawFrame
     70
     71	016D  5B				     pop bx
     72	016E  81 C3 00A2			     add bx, 162d
     73	0172  8A CC				     mov cl, ah
     74
     75	0174  58				     pop ax
     76	0175  52 53 56				     push dx bx	si
     77	0178  E8 004F				     call NumToHex
     78	017B  5E 5B 5A				     pop si bx dx
     79
     80	017E  58				     pop ax
     81	017F  81 C3 00A0			     add bx, 160d
     82	0183  52 53 56				     push dx bx	si
     83	0186  E8 0041				     call NumToHex
     84	0189  5E 5B 5A				     pop si bx dx
     85
     86	018C  58				     pop ax
     87	018D  81 C3 00A0			     add bx, 160d
     88	0191  52 53 56				     push dx bx	si
     89	0194  E8 0033				     call NumToHex
     90	0197  5E 5B 5A				     pop si bx dx
     91
     92	019A  58				     pop ax
     93	019B  81 C3 00A0			     add bx, 160d
     94	019F  52 53 56				     push dx bx	si
     95	01A2  E8 0025				     call NumToHex
     96	01A5  5E 5B 5A				     pop si bx dx
     97
     98	01A8  E4 61				     in	al, 61h
     99	01AA  0C 80				     or	al, 80h
    100	01AC  E6 61				     out 61h, al
    101	01AE  24 7F				     and al, not 80h
    102	01B0  E6 61				     out 61h, al
    103
    104	01B2  B0 20				     mov al, 20h
    105	01B4  E6 20				     out 20h, al
    106
    107	01B6  07 5F 5E 5A 59 5B	58		     pop es di si dx cx	bx ax
    108
    109	01BD  CF				     iret
    110
    111	01BE  07 5F 5E 5A 59 5B	58   @@Nothing:	     pop es di si dx cx	bx ax
    112
    113	01C5  EA				     db	0eah
    114	01C6  0000				     Old09ofs dw 0
Turbo Assembler	 Version 4.1	    03/05/23 15:48:43	    Page 3
resident.asm



    115	01C8  0000				     Old09Seg dw 0
    116
    117	01CA					     endp
    118
    119
    120				     ;------------------------------------------------
    121				     ; Print number in hex format
    122				     ;------------------------------------------------
    123				     ; Entry:	     AX	= number
    124				     ;			     BX	= coordinates
    125				     ;			     CX	= color
    126				     ; Exit:	     None
    127				     ; Expects:	     ES	= 0b800h
    128				     ; Destroys:     BX, DX, SI
    129				     ;------------------------------------------------
    130
    131	01CA			     NumToHex	     proc
    132
    133	01CA  50					     push ax
    134	01CB  33 F6					     xor si, si
    135
    136	01CD  83 FE 04		     @@Next:	     cmp si, 4d
    137	01D0  74 2D					     je	@@Done
    138
    139	01D2  8B D0					     mov dx, ax
    140	01D4  81 E2 F000				     and dx, 0F000h
    141	01D8  C1 EA 0C					     shr dx, 12
    142
    143	01DB  83 FA 0A					     cmp dx, 0Ah
    144
    145	01DE  73 09					     jae @@PrtSym
    146
    147	01E0  83 C2 30					     add dx, 30h
    148	01E3  26: 88 17					     mov byte ptr es:[bx], dl
    149	01E6  EB 0A 90					     jmp @@PrtColor
    150
    151	01E9  83 EA 0A		     @@PrtSym:	     sub dx, 0Ah
    152	01EC  83 C2 41					     add dx, 41h
    153	01EF  26: 88 17					     mov byte ptr es:[bx], dl
    154
    155	01F2  43		     @@PrtColor:     inc bx
    156	01F3  26: 88 0F					     mov byte ptr es:[bx], cl
    157	01F6  43					     inc bx
    158
    159	01F7  83 C6 01					     add si, 1
    160	01FA  C1 E0 04					     shl ax, 4
    161
    162	01FD  EB CE					     jmp @@Next
    163
    164
    165	01FF  58		     @@Done:	     pop ax
    166
    167	0200  C3					     ret
    168	0201						     endp
    169				     ;------------------------------------------------
    170				     ; Draws frame
    171				     ;------------------------------------------------
Turbo Assembler	 Version 4.1	    03/05/23 15:48:43	    Page 4
resident.asm



    172				     ; Entry:	     AH	= color
    173				     ;		 AL = frame style
    174				     ;			     CX	= width	of the frame
    175				     ;			     DX	= height of the	frame
    176				     ;		 DI = coordinates of the top left corner
    177				     ; Exit:	     none
    178				     ; Expects:	     ES	= 0b800h
    179				     ; Destroys: AL, SI, DI
    180				     ;------------------------------------------------
    181
    182	0201			     DrawFrame	 proc
    183
    184	0201  50				 push ax		     ; save style and color
    185	0202  51				 push cx		     ; save width
    186	0203  52				 push dx		     ; save height
    187	0204  57				 push di		     ; save starting coordinates
    188	0205  56				 push si		     ; save style or message ptr
    189	0206  57				 push di		     ; save coords
    190	0207  52				 push dx		     ; save height
    191
    192	0208  3C 00				 cmp al, 0h
    193	020A  74 00				 je @@StlDone
    194
    195	020C			     @@StlDone:
    196	020C  B0 DA				 mov al, 0dah			    ; top left corner in al
    197	020E  B6 C4				 mov dh, 0c4h		     ; top sym in dh
    198	0210  B2 BF				 mov dl, 0bfh		     ; top right corner	in dl
    199
    200	0212  E8 003E				 call DrawLine
    201
    202	0215  5A				 pop dx			     ; return dx
    203	0216  83 EA 02				 sub dx, 2
    204	0219  5F				 pop di
    205	021A  81 C7 00A0			 add di, 160d
    206
    207	021E  83 FA 00		     @@Height:	 cmp dx, 0h		     ; check for end
    208	0221  74 14				 je @@Done
    209
    210	0223  57				 push di		     ; saves coords, width
    211	0224  52				 push dx
    212
    213	0225  B0 B3				 mov al, 0b3h		     ; top left	corner in al
    214	0227  B6 20				 mov dh, ' '		     ; top sym in dh
    215	0229  B2 B3				 mov dl, 0b3h		     ; top right corner	in dl
    216
    217	022B  E8 0025				 call DrawLine
    218
    219	022E  5A				 pop dx			     ; coords to the next line
    220	022F  5F				 pop di
    221	0230  81 C7 00A0			 add di, 160d
    222
    223	0234  4A				 dec dx			     ; reduce height remaining
    224	0235  EB E7				 jmp @@Height
    225
    226	0237			     @@Done:
    227	0237  B0 C0				 mov al, 0c0h			   ; bottom left corner	in al
    228	0239  B6 C4				 mov dh, 0c4h		     ; bottom sym in dh
Turbo Assembler	 Version 4.1	    03/05/23 15:48:43	    Page 5
resident.asm



    229	023B  B2 D9				 mov dl, 0d9h		     ; bottom right corner in dl
    230	023D  E8 0013				 call DrawLine
    231
    232	0240  5E				 pop si			     ; start of	message
    233	0241  5F				 pop di			     ; starting	coords
    234	0242  5A				 pop dx			     ; height in dx
    235	0243  59				 pop cx			     ; width in	cx
    236
    237	0244  81 C7 00A2			 add di, 162d		     ; start of	the text
    238
    239	0248  58				 pop ax
    240
    241	0249  C3				 ret
    242	024A					 endp
    243
    244
    245	024A  DA C4 BF B3 20 B3	C0+  style1:	 db 0dah, 0c4h,	0bfh, 0b3h, ' ', 0b3h, 0c0h, 0c4h, 0d9h
    246	      C4 D9
    247				     ;------------------------------------------------
    248				     ; Draws line
    249				     ;------------------------------------------------
    250				     ; Entry:	     AH	= color
    251				     ;		 AL = left symbol
    252				     ;			     CX	= width	of the frame
    253				     ;		 DH = mid symbol
    254				     ;		 DL = right symbol
    255				     ;		 DI = coordinates of the start of line
    256				     ; Exit:	     none
    257				     ; Expects:	     ES	= 0b800h
    258				     ; Destroys: AL, DH, DL, DI
    259				     ;------------------------------------------------
    260
    261	0253			     DrawLine	 proc
    262
    263	0253  51				 push cx		 ; save	cx
    264	0254  AB				 stosw			 ; draw	right symbol
    265	0255  8A C6				 mov al, dh
    266
    267	0257  83 E9 02				 sub cx, 2
    268
    269	025A  F3> AB				 rep stosw		 ; draws middle	symbols
    270
    271	025C  8A C2				 mov al, dl		 ; draws left symbol
    272	025E  AB				 stosw
    273
    274	025F  59				 pop cx
    275
    276	0260					 endp
    277	0260  C3				 ret
    278
    279
    280	0261			     EOP:
    281				     end	     start
Turbo Assembler	 Version 4.1	    03/05/23 15:48:43	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/05/23"
??FILENAME			  Text	 "resident"
??TIME				  Text	 "15:48:43"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@DONE				  Near	 DGROUP:01FF
@@DONE				  Near	 DGROUP:0237
@@HEIGHT			  Near	 DGROUP:021E
@@NEXT				  Near	 DGROUP:01CD
@@NOTHING			  Near	 DGROUP:01BE
@@PRTCOLOR			  Near	 DGROUP:01F2
@@PRTSYM			  Near	 DGROUP:01E9
@@STLDONE			  Near	 DGROUP:020C
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0707H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 RESIDENT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
DRAWFRAME			  Near	 DGROUP:0201
DRAWLINE			  Near	 DGROUP:0253
EOP				  Near	 DGROUP:0261
NEW09				  Near	 DGROUP:0137
NUMTOHEX			  Near	 DGROUP:01CA
OLD09OFS			  Word	 DGROUP:01C6
OLD09SEG			  Word	 DGROUP:01C8
START				  Near	 DGROUP:0100
STYLE1				  Near	 DGROUP:024A

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0261 Word	  Public  CODE
